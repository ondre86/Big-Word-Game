const{toRaw:toRaw}=Vue;function $(t){return document.querySelectorAll(t)}const app=Vue.createApp({data:()=>({started:null,wasQuit:!1,paused:!1,pausePress:!1,pauseScroll:!1,startBtn:null,tutBtn:null,lost:null,tutorialOn:!1,introOff:!1,data:null,input:"",finalWord:"",t:15,wordCard:{word:null,type:null,defs:null,syllablesOther:null,syllablesCustom:null},wordCardOutlineColor:"#B79E01",textColor:"#000000",foundClosest:!1,closest:null,alpha:"abcdefghijklmnopqrstuvwxyz".split(""),alphaX:0,currentLetter:"a",isRandomOrder:!1,score:0,cookieScore:0,cookieHighScore:0,newHighScore:null,strikes:0,wordPlayed:!1,wordsList:new Set,vWordsScrolled:[],vWordsOBJList:[],customScore:null,tpScore:null,input:null,time:null,tries:0,wordMsg:"",mode:"",modeDescriptor:"",order:"default",classicModeOn:!1,hasUsername:!!localStorage.username,usernameInput:"",mpUsername:"",usernameError:null,changingUsername:null,mpUserTimestamp:null,chosenMatchmakingMode:!1,joiningParty:!1,wantsToCreateParty:!1,partyLeaderUsername:"",inParty:!1,isPartyLeader:!1,partyMemberUsername:" ",changedBranch:!1,branchTimer:null,multiPlayer:!1,mpClassicTut:!1,mpSpeedTut:!1,mpBattleTut:!1,mpCTisHidden:!0,mpSTisHidden:!0,mpWTisHidden:!0,webSocket:null,isWaiting:!1,waitingDots:null,inGameWaitingMsg:null,countingDown:!1,countdown:5,mpCountdownToGameStart:null,opponentName:"",mpLost:null,mpTie:null,mpLostReason:null,mpFinalScore:null,autoSent:!1,opponentScore:0}),watch:{strikes:{handler(){gsap.fromTo("#strikes span",{y:75},{y:0,duration:.5,ease:"power1.inOut"})},deep:!0},score:{handler(){gsap.fromTo("#score span",{y:75},{y:0,duration:.5,ease:"power1.inOut"})},deep:!0},currentLetter:{handler(){gsap.fromTo("#letter span",{y:75},{y:0,duration:.5,ease:"power1.inOut"})},deep:!0},t:{handler(){15==this.t&&gsap.fromTo(".timer",{y:75},{y:0,duration:.5,ease:"power1.inOut"}),this.t<6?gsap.to(".timer",{color:"red",duration:.5}):gsap.to(".timer",{color:this.textColor,duration:.5})},deep:!0}},methods:{newBranch(){this.changedBranch=!0,gsap.set(".tut-card",{y:50,opacity:0}),this.branchTimer||(this.branchTimer=setTimeout((()=>{this.changedBranch=!1,gsap.set(".tut-card",{y:0,opacity:1,duration:.35}),this.branchTimer=null}),100))},tutorialToggle(){this.tutorialOn?this.tutorialOn=!1:this.tutorialOn=!0,this.newBranch()},twoPlayer(){this.introOff?this.introOff=!1:this.introOff=!0,this.multiPlayer&&!this.lost?(this.multiPlayer=!1,navigator.sendBeacon("/",JSON.stringify({username:this.mpUsername,partyLeaderUsername:this.partyLeaderUsername?this.partyLeaderUsername:null,request:"leave"})),this.newBranch()):(this.resetStats(),localStorage.username&&(this.usernameInput=localStorage.username,this.$refs.userInput.value=localStorage.username,this.hasUsername=!0),this.setUsername())},mpCTHide(){this.mpCTisHidden?this.mpCTisHidden=!1:this.mpCTisHidden=!0},mpSTHide(){this.mpSTisHidden?this.mpSTisHidden=!1:this.mpSTisHidden=!0},mpWTHide(){this.mpWTisHidden?this.mpWTisHidden=!1:this.mpWTisHidden=!0},classicTutToggle(){this.mpClassicTut?this.mpClassicTut=!1:this.mpClassicTut=!0,this.newBranch()},speedTutToggle(){this.mpSpeedTut?this.mpSpeedTut=!1:this.mpSpeedTut=!0,this.newBranch()},battleTutToggle(){this.mpBattleTut?this.mpBattleTut=!1:this.mpBattleTut=!0,this.newBranch()},backToHome(){this.mpClassicTut=!1,this.classicModeOn=!1,this.mpSpeedTut=!1,this.mpBattleTut=!1,this.multiPlayer=!1,this.introOff=!1,this.chosenMatchmakingMode=!1,this.joiningParty=!1,this.lost=!1,this.scrollToTop()},mpBackToHome(t,e){this.mpClassicTut=!1,this.classicModeOn=!1,this.mpSpeedTut=!1,this.mpBattleTut=!1,this.introOff=!1,this.chosenMatchmakingMode=!1,this.joiningParty=!1,this.mode="",this.opponentScore=t,this.mpLostReason=e,this.scrollToTop()},chooseMatchmakingMode(t){switch(t){case"random":this.chosenMatchmakingMode=!0,this.newBranch();break;case"leader":fetch("/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.mpUsername,partyRequest:"create"})}).then((t=>t.json())).then((t=>this.isPartyLeader=t.createdNewParty)).then((()=>{this.isPartyLeader?(this.wantsToCreateParty=!0,this.chosenMatchmakingMode=!0,this.startWebSocket(),this.newBranch()):this.usernameErrorMSG("Party could not be created.")}));break;case"member":this.joiningParty=!0,this.newBranch()}},newGame(){this.tutorialOn=!1,this.started=!0,this.resetTimer()},mpClassicNewGame(){this.started=!0,this.isRandomOrder||(this.alphaX=0),this.currentLetter=this.alpha[this.alphaX]},shrinkHeader(){gsap.to(["#logo"],{height:"0px",duration:.5}),gsap.to("header",{margin:"0px",height:"0px",duration:.5},"<")},expandHeader(){gsap.to(["#logo"],{height:"60px",duration:.5}),gsap.to("header",{margin:"20px 0 40px",height:"60px",duration:.5},"<")},quit(){this.wasQuit=!0,setTimeout((()=>{this.wasQuit=!1}),500),this.started=!1,this.tutorialOn=!1,this.backToHome(),this.webSocket&&this.terminateWS(),this.score>this.cookieHighScore&&(this.newHighScore=!0,this.cookieScore=this.score,localStorage.setItem("highScore",`${this.score}`)),this.cookieScore=localStorage.lastScore?localStorage.lastScore:0,this.cookieHighScore=localStorage.highScore||""!==this.cookieHighScore?localStorage.highScore:0},resetStats(){this.wasQuit=!1,this.paused=!1,this.lost=!1,this.isRandomOrder&&!this.multiPlayer?this.alphaX=Math.floor(26*Math.random()):this.alphaX=0,this.currentLetter=this.alpha[this.alphaX],this.finalWord="",this.input="",this.wordsList.clear(),this.vWordsScrolled=[],this.vWordsOBJList=[],this.score=0,this.newHighScore=!1,this.strikes=0,this.wordPlayed=!1,this.customScore,this.tpScore=null,this.wordCard.word=null,this.wordCard.type=null,this.wordCard.defs=null,this.wordCard.syllablesOther=null,this.wordCard.syllablesCustom=null,this.foundClosest=!1,this.closest=null,this.$refs.input.style.outlineColor=this.wordCardOutlineColor,clearInterval(this.time),this.time=null,this.chosenMatchmakingMode=!1,this.mpLost=null,this.mpTie=null,this.mpLostReason=null,this.mpFinalScore=null,this.autoSent=!1},resetPlaceholder(){clearInterval(this.inGameWaitingMsg),this.$refs.input.style.textAlign="left",this.$refs.input.placeholder=""},resetWaiting(){this.isWaiting=!1,clearInterval(this.waitingDots),$("#waiting-text")[0]&&($("#waiting-text")[0].textContent="finding an opponent")},isInViewport(){const t=this.$refs.input.getBoundingClientRect();return t.top>=-30&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)?(this.pauseScroll=!1,this.pausePress||(this.paused=!1),!0):!!this.multiPlayer||(this.pauseScroll=!0,this.paused=!0,!1)},pause(){this.pausePress?(this.pausePress=!1,this.pauseScroll?this.$refs.input.disabled=!1:(this.paused=!1,this.$refs.input.disabled=!1,this.$refs.input.focus())):(this.pausePress=!0,this.paused||(this.paused=!0),this.$refs.input.disabled=!0)},timer(){this.isInViewport()&&!this.paused&&this.started&&(this.t>0&&(this.t--,this.$refs.input.disabled=!1),0==this.t&&3!=this.strikes?(this.$refs.input.disabled=!0,this.autoSent=!0,this.callServerDictionary()):0==this.t&&3==this.strikes&&this.stopTimerAndGame())},startTimer(){3==this.strikes?(this.started=!1,this.resetStats(),this.newGame()):(this.resetStats(),this.newGame())},resetTimer(){clearInterval(this.time),this.paused=!1,this.pausePress=!1,this.started&&(this.$refs.input.disabled=!1,this.$refs.input.focus()),this.$refs.input.focus(),this.t=15,this.time=setInterval(this.timer,1e3)},mpStopTimer(){clearInterval(this.time),this.paused=!0,this.$refs.input.disabled=!0},mpResetTimer(){clearInterval(this.time),this.$refs.input.disabled=!1,this.paused=!1,this.$refs.input.focus(),this.t=15,this.time=setInterval(this.timer,1e3)},mpRefreshTimer(){this.classicModeOn||(this.mpStopTimer(),this.mpResetTimer())},stopTimerAndGame(){clearInterval(this.time),this.t=15,this.started=!1,this.introOff=!1},async callServerDictionary(t){this.scrollToTop(),t&&t.preventDefault(),(""==this.input||!this.input||0==this.input.replace(/[^A-Za-z]/g,"").length)&&this.t>0||(null!=t||null!=t)&&this.t<=1||(""!=this.input&&this.input||0!=this.t?(0!=this.t?this.autoSent=!1:this.autoSent=!0,this.paused=!0,fetch("/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:this.input.replace(/[^A-Za-z]/g,"")})}).then((t=>t.json())).then((t=>{this.input=this.input.replace(/[^A-Za-z]/g,"").toLowerCase(),0==this.input.replace(/[^A-Za-z]/g,"").length?(this.autoSent=!1,this.strike(),this.foundClosest=!1,this.wordCard.word="Invalid Input"):(this.setData(t),this.enterWord(),this.input="",this.$refs.input.focus(),this.$refs.input.click())})).then((()=>{this.multiPlayer?(this.mpStopTimer(),this.t=15,this.multiPlayer&&!this.classicModeOn&&this.animateWaitingMsg()):this.resetTimer()})).catch((t=>{alert("Sorry, there was a problem communicating with our server.")}))):(this.autoSent=!1,this.strike(),this.foundClosest=!1,this.wordCard.word="Ran Out of Time"))},setData(t){this.data=t,this.wordCard.syllablesOther=t.tps},enterWord(){this.tries++;try{""==this.input||(this.data.data[0]&&toRaw(this.data.data[0].hwi)?toRaw(this.data.data[0].meta.id).includes("-")||toRaw(this.data.data[0].meta.id).includes(" ")?(this.strike(),this.wordCard.word="No Two-Part Words",this.wordCard.defs=null,this.foundClosest=!1):this.isCurrentLetter()?this.isOffensive()?(this.strike(),this.foundClosest=!1,this.wordCard.word="Offensive"):this.hasBeenUsed()?(this.strike(),this.foundClosest=!1,this.wordCard.word="Already Used"):(this.foundClosest=!1,this.syllableCountCustom(this.input,toRaw(this.data.data)),this.wordCardUpdate(this.input,toRaw(this.data.data)),this.syllableLengthCheck()?this.webSocket?this.wordPlayed&&this.tpScore?this.webSocket.send(JSON.stringify({score:this.wordCard.syllablesOther,time:Date.now(),word:this.wordCard,strikes:this.strikes,autoSent:this.autoSent})):this.wordPlayed&&this.customScore&&this.webSocket.send(JSON.stringify({score:this.wordCard.syllablesCustom,time:Date.now(),word:this.wordCard,strikes:this.strikes,autoSent:this.autoSent})):(this.scoreKeeper(),this.nextLetter(),this.$refs.input.style.outlineColor="green",this.scrollWordCardList()):(this.notLongEnough(),this.wordCard.word="Too Short")):(this.strike(),this.foundClosest=!1,this.wordCard.word="Wrong Starting Letter"):(toRaw(this.data.data[0])&&""!==toRaw(this.data.data[0])?(this.foundClosest=!0,this.closest=toRaw(this.data.data[0]),this.finalWord=this.closest):this.foundClosest=!1,this.strike(),this.wordCard.word="Not a Word"))}catch(t){this.strike(),this.foundClosest=!1,this.wordCard.word="Not a Word"}},strike(){this.strikes++,this.$refs.input.style.outlineColor="red",this.classicModeOn?this.cycleWordMessageClassic(0):this.cycleWordMessage(0),this.webSocket&&this.webSocket.send(JSON.stringify({score:0,time:Date.now(),word:null,strikes:this.strikes,autoSent:this.autoSent})),3==this.strikes?(this.finalWord=this.$refs.input.value,this.wordCard.word=null,this.wordCard.type=null,this.wordCard.defs=null,localStorage.setItem("lastScore",`${this.score}`),this.score>this.cookieHighScore?(this.newHighScore=!0,localStorage.setItem("highScore",`${this.score}`)):this.newHighScore=!1,this.webSocket||(this.lost=!0,this.stopTimerAndGame())):(this.multiPlayer?(this.mpStopTimer(),this.classicModeOn||this.mpResetTimer()):this.resetTimer(),this.wordCard.word=null,this.wordCard.type=null,this.wordCard.defs=null)},isOffensive(){return toRaw(this.data.data[0].meta.offensive)},isCurrentLetter(){return this.currentLetter=this.alpha[this.alphaX],this.input.split("")[0].toLowerCase()==this.alpha[this.alphaX].toLowerCase()},hasBeenUsed(){if(this.wordsList.has(this.input)||this.wordsList.has(this.input.charAt(0).toUpperCase()+this.input.slice(1))){for(let t=0;t<this.$refs.wl.children.length;t++)(this.$refs.wl.children[t].innerHTML.includes(this.input)||this.$refs.wl.children[t].innerHTML.includes(this.input.charAt(0).toUpperCase()+this.input.slice(1)))&&(gsap.to(this.$refs.wl,{scrollTo:{y:0,x:this.$refs.wl.children[t].offsetLeft-this.$refs.wl.clientWidth/2+this.$refs.wl.children[t].clientWidth/2,autokill:!0},duration:.5}),this.$refs.wl.children[t].children[0].classList.add("active"),setTimeout((()=>{this.$refs.wl.children[t].children[0].classList.remove("active")}),2500));return!0}return!1},notLongEnough(){this.strike()},syllableCountCustom(t,e){let s=[];for(let i=0;i<e[0].meta.stems.length;i++)if(t==e[0].meta.stems[i])if(null!=e[0].hwi){if(s.push(e[0].hwi.hw.split("*")),null!=e[0].uros)for(let t in e[0].uros)s.push(e[0].uros[t].ure.split("*"));for(let e in s)s[e].join("")==t&&(this.wordCard.syllablesCustom=s[e].length)}else if(null!=e[0].uros)for(let i in e[0].uros)s.push(e[0].uros[i].ure.split("*")),s[i].join("")==t&&(this.wordCard.syllablesCustom=s[i].length)},syllableLengthCheck(){return toRaw(this.wordCard.syllablesCustom)<3&&toRaw(this.wordCard.syllablesOther)<3?this.wordPlayed=!1:toRaw(!this.wordCard.syllablesCustom)&&toRaw(this.wordCard.syllablesOther)&&toRaw(this.wordCard.syllablesOther)>=3||toRaw(this.wordCard.syllablesCustom)<3&&toRaw(this.wordCard.syllablesOther)>=3?(this.wordListUpdate(),this.tpScore=!0,this.wordPlayed=!0):toRaw(this.wordCard.syllablesCustom)>=3&&toRaw(this.wordCard.syllablesOther)<3?this.wordCard.syllablesCustom-this.wordCard.syllablesOther>1?this.wordPlayed=!1:(this.wordListUpdate(),this.customScore=!0,this.wordPlayed=!0):toRaw(this.wordCard.syllablesCustom)>=3&&toRaw(this.wordCard.syllablesOther)>=3&&toRaw(this.wordCard.syllablesOther)>toRaw(this.wordCard.syllablesCustom)?(this.wordListUpdate(),this.tpScore=!0,this.wordPlayed=!0):toRaw(this.wordCard.syllablesCustom)>=3&&toRaw(this.wordCard.syllablesOther)>=3&&toRaw(this.wordCard.syllablesOther)<toRaw(this.wordCard.syllablesCustom)?(this.wordListUpdate(),this.customScore=!0,this.wordPlayed=!0):toRaw(this.wordCard.syllablesCustom)>=3&&toRaw(this.wordCard.syllablesOther)>=3&&toRaw(this.wordCard.syllablesCustom)==toRaw(this.wordCard.syllablesOther)?(this.wordListUpdate(),this.tpScore=!0,this.wordPlayed=!0):void 0},wordCardUpdate(t,e){for(let s=0;s<e[0].meta.stems.length;s++)t==e[0].meta.stems[s].toLowerCase()&&(this.wordCard.word=e[0].meta.stems[s],this.wordCard.type=e[0].fl,this.wordCard.defs=e[0].shortdef);this.multiPlayer||null!=this.wordCard.defs&&this.vWordsOBJList.push(Object.values(toRaw(this.wordCard))),inOut.fromTo(["#word-card"],{y:75,opacity:0},{y:0,opacity:1,duration:.5,ease:"power1.inOut"})},mpWordCardUpdate(t){t&&t.word&&(this.wordCard.word=t.word),t&&t.type&&(this.wordCard.type=t.type),t&&t.defs&&(this.wordCard.defs=t.defs),t&&t.syllablesOther&&(this.wordCard.syllablesOther=t.syllablesOther),t&&t.syllableCountCustom&&(this.wordCard.syllablesCustom=t.syllablesCustom)},replaceWordCard(t){this.finalWord="";for(let e=0;e<this.$refs.wl.children.length;e++)this.$refs.wl.children[e].childNodes[0].classList.remove("active"),t.target.innerHTML==toRaw(this.vWordsOBJList[e][0])&&(t.target.classList.add("active"),this.wordCard.word=toRaw(this.vWordsOBJList[e][0]),this.wordCard.type=toRaw(this.vWordsOBJList[e][1]),this.wordCard.defs=toRaw(this.vWordsOBJList[e][2]));gsap.to(this.$refs.wl,{scrollTo:{y:0,x:t.target.offsetLeft-this.$refs.wl.clientWidth/2+t.target.clientWidth/2,autokill:!0},duration:.5}),gsap.to(this.$refs.wcScroller,{scrollTo:0,duration:.5})},wordListUpdate(){this.multiPlayer||(this.wordPlayed=!0,this.wordsList.add(toRaw(this.wordCard.word)))},mpWordListUpdate(){if(!this.$refs.wl.children[0]){const t=document.createElement("li");t.innerHTML='<button class="btn font2"></button>',t.addEventListener("click",(()=>{this.replaceWordCard()})),t.addEventListener("keydown",(t=>{32===t.keyCode&&this.replaceWordCard(),13===t.keyCode&&this.replaceWordCard()}))}this.wordPlayed=!0,this.wordsList.add(toRaw(this.wordCard.word)),null!=this.wordCard.defs&&this.vWordsOBJList.push(Object.values(toRaw(this.wordCard)))},cycleWordMessage(t){this.classicModeOn||(this.wordMsg=!t||t<3?"❌":"✅"),this.animateWordMsg()},cycleWordMessageClassic(t){this.classicModeOn&&(this.wordMsg=!t||t<3?"❌":"✅"),this.animateWordMsg()},mpWordMsg(){this.classicModeOn||(this.wordMsg="🔁"),this.animateWordMsg()},animateWordMsg(){wm=gsap.timeline().fromTo(this.$refs.wordMsg,{y:"100%",opacity:0},{y:"0%",opacity:1,duration:.5}).to(this.$refs.wordMsg,{y:"100%",opacity:0,duration:.5},"<+=2")},animateWaitingMsg(){clearInterval(this.inGameWaitingMsg),this.$refs.input.style.textAlign="center";let t="waiting",e=0;this.$refs.input.placeholder=t,this.inGameWaitingMsg=setInterval((()=>{e++,t=t.concat("."),this.$refs.input.placeholder=t,4==e&&(e=0,t="waiting",this.$refs.input.placeholder=t)}),1e3)},emphasizeWordCard(){wcOutline=gsap.timeline().to(this.$refs.wordCardDisplay,{outline:`9px solid ${this.wordCardOutlineColor}`,duration:.5}).to(this.$refs.wordCardDisplay,{outline:`0px solid ${this.wordCardOutlineColor}`,duration:.5},"<+=2")},emphasizeInput(t,e=this.wordCard.syllablesOther){t?this.$refs.input.style.outlineColor="green":0!=e&&(this.$refs.input.style.outlineColor=this.wordCardOutlineColor)},scoreKeeper(){this.wordPlayed&&this.tpScore?(this.classicModeOn||this.cycleWordMessage(this.wordCard.syllablesOther),this.score+=this.wordCard.syllablesOther,this.cookieScore=this.score,localStorage.setItem("lastScore",`${this.score}`)):this.wordPlayed&&this.customScore&&(this.classicModeOn||this.cycleWordMessage(this.wordCard.syllablesCustom),this.score+=this.wordCard.syllablesCustom,this.cookieScore=this.score,localStorage.setItem("lastScore",`${this.score}`)),this.score>this.cookieHighScore&&(this.newHighScore=!0,this.cookieScore=this.score,localStorage.setItem("highScore",`${this.score}`))},mpScoreFinal(t){localStorage.setItem("lastScore",`${t}`),t>this.cookieHighScore&&(this.newHighScore=!0,localStorage.setItem("highScore",`${t}`))},randomOrder(t){t?(this.isRandomOrder=!0,this.order="random",this.multiPlayer||(this.alphaX=Math.floor(26*Math.random()),this.currentLetter=this.alpha[this.alphaX])):(this.isRandomOrder=!1,this.order="default",this.alphaX=0,this.currentLetter=this.alpha[this.alphaX])},nextLetter(){this.isRandomOrder?this.alphaX=Math.floor(26*Math.random()):25==this.alphaX?this.alphaX=0:this.alphaX++,this.currentLetter=this.alpha[this.alphaX],this.tpScore,this.customScore=!1,this.wordPlayed=!1,this.$refs.input.focus()},mpNextLetter(t,e){this.alphaX=e,this.currentLetter=t||this.alpha[e],this.tpScore,this.customScore=!1,this.wordPlayed=!1,this.$refs.input.focus()},scrollWordCardList(){setTimeout((()=>{this.$refs.wl.children[this.$refs.wl.children.length-1]&&(this.vWordsScrolled.push(this.$refs.wl.children[this.$refs.wl.children.length-1].scrollWidth),gsap.to(this.$refs.wl,{scrollTo:{y:0,x:this.$refs.wl.scrollWidth,autokill:!0},duration:1}))}),100)},scrollToTop(){gsap.to("body",{scrollTo:{y:0,x:0,autokill:!0},duration:.5,ease:"power4.out"}),this.$refs.wcScroller&&gsap.to(this.$refs.wcScroller,{scrollTo:0,duration:.5})},setUsername(t){t&&t.preventDefault(),""!=this.usernameInput&&""!=this.$refs.userInput.value&&this.$refs.userInput||localStorage.username?(this.mpUsername=this.usernameInput.replace(/[^a-zA-Z0-9]/g,""),this.mpUserTimestamp=Date.now(),fetch("/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldUsername:localStorage.username,oldJoinDate:localStorage.usernameDate,username:this.mpUsername,joinDate:this.mpUserTimestamp,request:"join"})}).then((t=>t.json())).then((t=>{t.registered?(this.hasUsername=!0,this.multiPlayer=!0,localStorage.setItem("username",this.mpUsername),localStorage.setItem("usernameDate",this.mpUserTimestamp),this.$refs.userInput.value="",this.usernameInput="",this.newBranch()):(this.hasUsername=!1,localStorage.username&&this.newBranch(),this.changingUsername?this.mpUsername=localStorage.username:this.mpUsername="",t.profane?this.usernameErrorMSG("No profanity allowed."):t.empty?this.usernameErrorMSG("Username cannot be blank."):this.usernameErrorMSG("Username unavailable."))}))):this.newBranch()},usernameErrorMSG(t){this.usernameError||(this.$refs.userInput.style.outlineColor="red",this.usernameError=document.createElement("span"),this.usernameError.classList.add("font-2","txt-center"),this.usernameError.setAttribute("id","username-error")),this.usernameError.innerHTML=`${t} <br> Try again.`,$("#username-section")[0].children[1].append(this.usernameError)},joinPartyByUsername(t){t&&t.preventDefault(),""!=this.usernameInput&&this.$refs.userInput.value?(this.partyLeaderUsername=this.usernameInput.replace(/[^a-zA-Z0-9]/g,""),fetch("/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.mpUsername,partyLeaderUsername:this.partyLeaderUsername,partyRequest:"join"})}).then((t=>t.json())).then((t=>{t.joinedParty?(this.inParty=!0,this.startWebSocket(),this.newBranch()):(t.inactive&&this.usernameErrorMSG("User has no active party."),t.duplicate&&this.usernameErrorMSG("Cannot join own party."),t.full&&this.usernameErrorMSG("Party is full."))}))):this.usernameErrorMSG("Username cannot be blank.")},deleteParty(){this.webSocket.send(JSON.stringify({username:this.mpUsername,partyRequest:"delete"})),this.wantsToCreateParty=!1,this.isPartyLeader=!1,this.chosenMatchmakingMode=!1,this.partyMemberUsername=" ",this.lost||this.newBranch()},leaveParty(){this.webSocket.send(JSON.stringify({username:this.mpUsername,partyLeader:this.partyLeaderUsername,partyRequest:"leave"})),this.inParty=!1,this.joiningParty=!1,this.isWaiting=!1,this.chosenMatchmakingMode=!1,this.lost||this.newBranch()},startWebSocket(){this.determineMode(),this.webSocket?this.webSocket.send(JSON.stringify({mode:this.mode,order:this.order,username:this.mpUsername})):(this.webSocket=new WebSocket(`wss://${window.location.hostname}:${window.location.port}`),this.webSocket.addEventListener("open",(t=>{this.inParty&&this.webSocket.send(JSON.stringify({username:this.mpUsername,inParty:this.inParty,partyLeader:this.partyLeaderUsername})),this.isPartyLeader?this.webSocket.send(JSON.stringify({username:this.mpUsername,isPartyLeader:this.isPartyLeader})):""!=this.mode&&this.webSocket.send(JSON.stringify({mode:this.mode,order:this.order,username:this.mpUsername}))})),this.webSocket.addEventListener("message",(t=>{rep=JSON.parse(t.data),rep.waiting&&(this.isWaiting=!0,this.newBranch(),this.inParty?this.waitingDots=setInterval((()=>{$("#waiting-text")[0].textContent+=".","waiting for leader...."==$("#waiting-text")[0].textContent&&($("#waiting-text")[0].textContent="waiting for leader")}),1e3):this.waitingDots=setInterval((()=>{$("#waiting-text")[0].textContent+=".","finding an opponent...."==$("#waiting-text")[0].textContent&&($("#waiting-text")[0].textContent="finding an opponent")}),1e3)),rep.partyMemberUsername?this.partyMemberUsername=rep.partyMemberUsername:!rep.waiting&&rep.inGame&&(rep.isClassic&&(this.classicModeOn=!0),this.determineMode(rep.mode),clearInterval(this.waitingDots),this.opponentName=rep.opponent,this.countingDown=!0,this.mpCountdownToGameStart=setInterval((()=>{this.countdown--,0==this.countdown&&(clearInterval(this.mpCountdownToGameStart),this.countdown=5,this.countingDown=!1,this.resetStats(),this.classicModeOn?(this.mpClassicNewGame(),rep.isYourTurn?(this.mpResetTimer(),this.resetPlaceholder(),clearInterval(this.inGameWaitingMsg)):(this.mpStopTimer(),this.animateWaitingMsg())):(this.newGame(),this.resetPlaceholder(),clearInterval(this.inGameWaitingMsg)),this.isWaiting=!1,this.mpNextLetter(rep.letter,rep.letterIndex))}),1e3)),this.classicModeOn?rep.isYourTurn?(this.mpResetTimer(),this.resetPlaceholder(),clearInterval(this.inGameWaitingMsg)):(this.mpStopTimer(),this.animateWaitingMsg()):(this.resetPlaceholder(),clearInterval(this.inGameWaitingMsg)),this.started&&(1==rep.winner?(rep.winningWord&&this.mpWordListUpdate(),this.mpWordMsg(),this.classicModeOn&&!rep.isYourTurn&&this.cycleWordMessageClassic(rep.score),this.$forceUpdate(),this.emphasizeInput(!0),this.scoreKeeper(),this.mpNextLetter(rep.letter,rep.letterIndex),this.mpRefreshTimer(),this.scrollWordCardList()):rep.winner?"tie"==rep.winner&&((this.classicModeOn&&!rep.isYourTurn||!this.classicModeOn&&0!==rep.score)&&this.mpWordMsg(),this.$forceUpdate(),this.emphasizeInput(!1,rep.score),this.mpNextLetter(rep.letter,rep.letterIndex),this.mpRefreshTimer()):(this.wordCard.defs||inOut.fromTo(["#word-card"],{y:75,opacity:0},{y:0,opacity:1,duration:.5,ease:"power1.inOut"}),this.finalWord="",this.mpWordCardUpdate(rep.winningWord),rep.winningWord&&this.mpWordListUpdate(),rep.score&&0!==rep.score&&this.classicModeOn&&!rep.isYourTurn&&this.cycleWordMessageClassic(rep.score),0===rep.score||this.classicModeOn||this.mpWordMsg(),this.$forceUpdate(),this.emphasizeInput(!1,rep.score),this.emphasizeWordCard(),this.mpNextLetter(rep.letter,rep.letterIndex),this.mpRefreshTimer(),this.scrollWordCardList())),(rep.lost||rep.won||rep.tie||rep.opponentForfeit)&&(this.lost=!0,this.mpBackToHome(rep.otherScore,rep.reason),this.mpScoreFinal(rep.totalScore),this.mpEndGame(),rep.lost?this.mpLost=!0:rep.won?this.mpLost=!1:rep.tie&&(this.mpLost=!1,this.mpTie=!0),rep.opponentForfeit&&(this.countingDown&&clearInterval(this.mpCountdownToGameStart),this.mpLost=!1))})),this.webSocket.addEventListener("close",(t=>{this.terminateWS()})))},determineMode(t){this.mpClassicTut||t&&"Classic"==t?(this.mode="Classic",this.modeDescriptor="Take turns playing big words!"):this.mpSpeedTut||t&&"Speed"==t?(this.mode="Speed",this.modeDescriptor="Race to play your big word first!"):(this.mpBattleTut||t&&"Battle"==t)&&(this.mode="Battle",this.modeDescriptor="Play the biggest word!")},mpEndGame(){this.resetWaiting(),this.resetPlaceholder(),this.stopTimerAndGame(),this.terminateWS()},softCloseWS(){this.webSocket&&(this.mpClassicTut&&(this.mpClassicTut=!0,this.mpSpeedTut=!1,this.mpBattleTut=!1),this.mpSpeedTut&&(this.mpClassicTut=!1,this.mpSpeedTut=!0,this.mpBattleTut=!1),this.mpBattleTut&&(this.mpClassicTut=!1,this.mpSpeedTut=!1,this.mpBattleTut=!0),this.newBranch(),this.terminateWS())},terminateWS(){this.started=!1,this.resetWaiting(),this.resetPlaceholder(),clearInterval(this.mpCountdownToGameStart),this.countingDown=!1,this.countdown=5,this.inParty&&this.leaveParty(),this.isPartyLeader&&this.deleteParty(),this.webSocket&&(this.webSocket.close(),this.webSocket=null)}},mounted:function(){gsap.registerPlugin(ScrollToPlugin),this.scrollToTop(),$("#app")[0].style.display="flex",inOut=gsap.timeline(),this.$forceUpdate(),localStorage.lastScore&&localStorage.highScore?(this.cookieScore=localStorage.lastScore?localStorage.lastScore:0,this.cookieHighScore=localStorage.highScore||""!==this.cookieHighScore?localStorage.highScore:0):(localStorage.setItem("lastScore","0"),localStorage.setItem("highScore","0")),window.addEventListener("beforeunload",(t=>{navigator.sendBeacon("/",JSON.stringify({username:this.mpUsername,partyLeaderUsername:this.partyLeaderUsername?this.partyLeaderUsername:null,request:"leave"})),this.webSocket&&this.webSocket.close(),localStorage.setItem("lastScore",`${this.score}`),this.score>this.cookieHighScore&&(this.newHighScore=!0,localStorage.setItem("highScore",`${this.score}`))})),$("#form")[0].addEventListener("submit",this.callServerDictionary),this.$refs.input.addEventListener("keydown",(t=>{this.$refs.input.style.outlineColor=this.wordCardOutlineColor,32===t.keyCode&&t.preventDefault(),(t.metaKey||t.ctrlKey)&&"v"==t.key&&t.preventDefault()})),this.$refs.input.addEventListener("contextmenu",(t=>t.preventDefault())),this.$refs.post.addEventListener("mousedown",(t=>t.preventDefault())),this.$refs.userInput.addEventListener("keydown",(t=>{this.$refs.userInput.style.outlineColor=this.wordCardOutlineColor,t.key.match(/^[a-zA-Z0-9_]+$/)||t.preventDefault(),this.usernameError&&($("#username-error")[0].remove(this.usernameError),this.usernameError=null)})),this.$refs.userInput.addEventListener("paste",(t=>{setTimeout((()=>{this.$refs.userInput.value=this.$refs.userInput.value.replace(/[^a-zA-Z0-9]/g,"")}),1)})),this.wordCardOutlineColor=window.matchMedia("(prefers-color-scheme: dark)").matches?"#8875FF":"#B79E01",this.textColor=window.matchMedia("(prefers-color-scheme: dark)").matches?"#ffffff":"#000000",window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(t=>{this.wordCardOutlineColor=window.matchMedia("(prefers-color-scheme: dark)").matches?"#8875FF":"#fddc02",this.textColor=window.matchMedia("(prefers-color-scheme: dark)").matches?"#ffffff":"#000000"}))},updated:function(){this.$refs.wl.children.length>=3&&(this.$refs.wl.style.justifyContent="initial"),this.started?(this.shrinkHeader(),15!=this.t||this.paused||setTimeout((()=>{this.$refs.input.focus()}),250)):(this.expandHeader(),this.cookieScore=localStorage.lastScore,this.cookieHighScore=localStorage.highScore),this.joiningParty?$("#username-form")[0].addEventListener("submit",this.joinPartyByUsername):$("#username-form")[0].addEventListener("submit",this.setUsername)}}).mount("#app");